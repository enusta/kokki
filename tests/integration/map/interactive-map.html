<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åœ°å›³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .test-map {
            width: 100%;
            height: 500px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: none;
            background: #4CAF50;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-btn:hover {
            background: #45a049;
        }
        
        .test-info {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .feature-list {
            list-style-type: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .feature-list li:before {
            content: "âœ“ ";
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–åœ°å›³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h1>
            <p>Task 8: åœ°å›³ã®ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³æ©Ÿèƒ½ã€å›½ã‚¯ãƒªãƒƒã‚¯æƒ…å ±è¡¨ç¤ºã€ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼å¯¾å¿œ</p>
        </div>
        
        <div class="test-info">
            <h3>å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½:</h3>
            <ul class="feature-list">
                <li>ã‚«ã‚¹ã‚¿ãƒ ã‚ºãƒ¼ãƒ ãƒ»ãƒ‘ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«</li>
                <li>åœ°å›³ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å›½æƒ…å ±è¡¨ç¤º</li>
                <li>ãƒ¢ãƒã‚¤ãƒ«ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼å¯¾å¿œ</li>
                <li>ç”»é¢å›è»¢ãƒ»ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ</li>
                <li>é•·æŠ¼ã—ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰</li>
                <li>ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«ã«å¿œã˜ãŸãƒãƒ¼ã‚«ãƒ¼èª¿æ•´</li>
            </ul>
        </div>
        
        <div class="test-controls">
            <button class="test-btn" onclick="initializeTestMap()">åœ°å›³ã‚’åˆæœŸåŒ–</button>
            <button class="test-btn" onclick="testCountryHighlight()">å›½ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ</button>
            <button class="test-btn" onclick="testZoomControls()">ã‚ºãƒ¼ãƒ æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-btn" onclick="testPanControls()">ãƒ‘ãƒ³æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-btn" onclick="testMobileFeatures()">ãƒ¢ãƒã‚¤ãƒ«æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
            <button class="test-btn" onclick="resetTestMap()">åœ°å›³ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        
        <div id="test-map" class="test-map"></div>
        
        <div class="test-info">
            <h3>ãƒ†ã‚¹ãƒˆæ‰‹é †:</h3>
            <ol>
                <li><strong>åœ°å›³ã‚’åˆæœŸåŒ–</strong>ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åœ°å›³ã‚’è¡¨ç¤º</li>
                <li>åœ°å›³ä¸Šã®ä»»æ„ã®å ´æ‰€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å›½æƒ…å ±ã‚’ç¢ºèª</li>
                <li>å³ä¸Šã®ã‚«ã‚¹ã‚¿ãƒ ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨</li>
                <li>å·¦ä¸Šã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨</li>
                <li>ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ ã€ãƒ‰ãƒ©ãƒƒã‚°ã§ãƒ‘ãƒ³ã‚’ç¢ºèª</li>
                <li>ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹ã§ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚’ç¢ºèª</li>
                <li>ç”»é¢ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã—ã¦å¿œç­”æ€§ã‚’ç¢ºèª</li>
            </ol>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>
    
    <!-- Custom JavaScript -->
    <script src="../../../js/countryService.js"></script>
    <script src="../../../js/map.js"></script>
    
    <script>
        // Test-specific variables
        let testMap = null;
        let testCountries = [];
        
        // Mock game state for testing
        window.gameState = {
            currentCountry: {
                name: { common: "Japan" },
                flag: "ğŸ‡¯ğŸ‡µ",
                capital: ["Tokyo"],
                region: "Asia",
                subregion: "Eastern Asia",
                population: 125836021,
                area: 377930,
                latlng: [36.0, 138.0]
            }
        };
        
        // Mock countries data for testing
        window.allCountries = [
            {
                name: { common: "Japan" },
                flag: "ğŸ‡¯ğŸ‡µ",
                capital: ["Tokyo"],
                region: "Asia",
                subregion: "Eastern Asia",
                population: 125836021,
                area: 377930,
                latlng: [36.0, 138.0]
            },
            {
                name: { common: "United States" },
                flag: "ğŸ‡ºğŸ‡¸",
                capital: ["Washington, D.C."],
                region: "Americas",
                subregion: "North America",
                population: 331002651,
                area: 9833517,
                latlng: [38.0, -97.0]
            },
            {
                name: { common: "France" },
                flag: "ğŸ‡«ğŸ‡·",
                capital: ["Paris"],
                region: "Europe",
                subregion: "Western Europe",
                population: 67391582,
                area: 551695,
                latlng: [46.0, 2.0]
            },
            {
                name: { common: "Australia" },
                flag: "ğŸ‡¦ğŸ‡º",
                capital: ["Canberra"],
                region: "Oceania",
                subregion: "Australia and New Zealand",
                population: 25499884,
                area: 7692024,
                latlng: [-27.0, 133.0]
            }
        ];
        
        function initializeTestMap() {
            // Override map container ID for testing
            const originalMapId = 'world-map';
            const testMapId = 'test-map';
            
            // Temporarily change the map initialization to use test container
            const originalInit = initializeMap;
            window.initializeMap = function() {
                try {
                    const mapContainer = document.getElementById(testMapId);
                    if (!mapContainer) {
                        console.error('Test map container not found');
                        return false;
                    }

                    // Initialize Leaflet map with enhanced mobile support
                    map = L.map(testMapId, {
                        center: MAP_CONFIG.center,
                        zoom: MAP_CONFIG.zoom,
                        minZoom: MAP_CONFIG.minZoom,
                        maxZoom: MAP_CONFIG.maxZoom,
                        zoomControl: MAP_CONFIG.zoomControl,
                        scrollWheelZoom: MAP_CONFIG.scrollWheelZoom,
                        touchZoom: MAP_CONFIG.touchZoom,
                        doubleClickZoom: MAP_CONFIG.doubleClickZoom,
                        boxZoom: MAP_CONFIG.boxZoom,
                        keyboard: MAP_CONFIG.keyboard,
                        dragging: MAP_CONFIG.dragging,
                        tap: MAP_CONFIG.tap,
                        tapTolerance: MAP_CONFIG.tapTolerance,
                        bounceAtZoomLimits: MAP_CONFIG.bounceAtZoomLimits
                    });

                    // Add tile layer
                    L.tileLayer(TILE_LAYER.url, {
                        attribution: TILE_LAYER.attribution,
                        maxZoom: TILE_LAYER.maxZoom
                    }).addTo(map);

                    // Set up map interactions
                    setupMapInteractions();
                    
                    // Enable mobile touch gestures
                    enableMobileTouchGestures();

                    console.log('Test map initialized successfully');
                    return true;
                    
                } catch (error) {
                    console.error('Error initializing test map:', error);
                    return false;
                }
            };
            
            // Initialize the test map
            const success = initializeMap();
            
            if (success) {
                alert('åœ°å›³ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸï¼\n\nåœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å›½æƒ…å ±ã‚’è¡¨ç¤ºã—ãŸã‚Šã€ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚');
            } else {
                alert('åœ°å›³ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
            }
        }
        
        function testCountryHighlight() {
            if (!map) {
                alert('ã¾ãšåœ°å›³ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            const testCountry = window.allCountries[0]; // Japan
            const coordinates = getCountryCoordinates(testCountry);
            
            if (coordinates) {
                highlightCountry('JP', coordinates);
                alert('æ—¥æœ¬ãŒãƒã‚¤ãƒ©ã‚¤ãƒˆã•ã‚Œã¾ã—ãŸï¼åœ°å›³ä¸Šã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°æƒ…å ±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            } else {
                alert('å›½ã®åº§æ¨™ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚');
            }
        }
        
        function testZoomControls() {
            if (!map) {
                alert('ã¾ãšåœ°å›³ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            alert('ã‚ºãƒ¼ãƒ æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š\n\n1. å³ä¸Šã®ã‚«ã‚¹ã‚¿ãƒ ã‚ºãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ+ã€âˆ’ã€ğŸŒï¼‰ã‚’ä½¿ç”¨\n2. ãƒã‚¦ã‚¹ãƒ›ã‚¤ãƒ¼ãƒ«ã§ã‚ºãƒ¼ãƒ \n3. ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§ã‚ºãƒ¼ãƒ ã‚¤ãƒ³');
        }
        
        function testPanControls() {
            if (!map) {
                alert('ã¾ãšåœ°å›³ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            alert('ãƒ‘ãƒ³æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š\n\n1. å·¦ä¸Šã®ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆçŸ¢å°ã€âŒ‚ï¼‰ã‚’ä½¿ç”¨\n2. åœ°å›³ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦ç§»å‹•\n3. âŒ‚ãƒœã‚¿ãƒ³ã§ä¸­å¤®ã«æˆ»ã‚‹');
        }
        
        function testMobileFeatures() {
            if (!map) {
                alert('ã¾ãšåœ°å›³ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            alert('ãƒ¢ãƒã‚¤ãƒ«æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã™ï¼š\n\n1. ã‚¿ãƒƒãƒã§ãƒ‰ãƒ©ãƒƒã‚°ï¼ˆãƒ‘ãƒ³ï¼‰\n2. ãƒ”ãƒ³ãƒã§ã‚ºãƒ¼ãƒ \n3. é•·æŠ¼ã—ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼\n4. ç”»é¢å›è»¢ã§è‡ªå‹•èª¿æ•´');
        }
        
        function resetTestMap() {
            if (!map) {
                alert('ã¾ãšåœ°å›³ã‚’åˆæœŸåŒ–ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            resetMapView();
            alert('åœ°å›³ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸï¼');
        }
    </script>
</body>
</html>