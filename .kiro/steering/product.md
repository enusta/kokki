---
inclusion: always
---

# 国旗あてゲーム (Flag Guessing Game)

プレイヤーが国旗を見て国を特定する、インタラクティブなWebベースの地理クイズゲーム。世界地図の可視化機能と複数の難易度レベルを統合。

## 主要機能
- **国旗認識クイズ**: 国旗を表示し、選択肢から正解を選ぶ
- **インタラクティブ世界地図**: 回答時に正解の国をハイライトするLeafletベースの地図
- **難易度レベル**: 初級（25カ国、10問）、中級（60カ国、15問）、上級（150カ国以上、20問）
- **リアルタイムスコア**: 正答率と進捗インジケーターによるライブスコア追跡
- **包括的テスト**: 全ゲーム機能をカバーする完全な統合テストスイート

## アーキテクチャ・技術スタック
- **フロントエンド**: Vanilla JavaScript (ES6+)、HTML5、CSS3
- **地図機能**: インタラクティブ世界地図可視化のためのLeaflet.js
- **データソース**: 国旗画像と国データのためのREST Countries API
- **テスト**: 自動テストランナー付きカスタムHTMLベース統合テスト
- **言語**: 日本語UI、英語コードコメント

## コード構成
- `js/app.js`: メインアプリケーション初期化とイベント処理
- `js/game.js`: コアゲームロジック、状態管理、スコアリング
- `js/countryService.js`: API統合と国データ管理
- `js/ui.js`: UI更新、画面遷移、ユーザーフィードバック
- `js/map.js`: Leaflet地図統合と国ハイライト
- `index.html`: レスポンシブデザインのメインゲームインターフェース
- `styles.css`: 全ゲーム画面とコンポーネントの完全スタイリング

## 開発ガイドライン
- **エラーハンドリング**: ユーザーフレンドリーな日本語メッセージと優雅なフォールバックによる包括的エラーハンドリング
- **パフォーマンス**: 効率的な国旗画像プリロードとメモリ管理
- **アクセシビリティ**: キーボードナビゲーションサポートとセマンティックHTML構造
- **レスポンシブデザイン**: フレキシブルグリッドシステムによるモバイルフレンドリーレイアウト
- **コード品質**: 詳細なJSDocコメント、一貫した命名規則、モジュラーアーキテクチャ

## ゲームフロー要件
1. **開始画面**: 詳細説明付き難易度選択
2. **ゲーム画面**: 国旗表示、回答選択肢、地図統合、進捗追跡
3. **結果画面**: 最終スコア、正答率統計、リプレイオプション
4. **エラーハンドリング**: ネットワーク障害回復とデータ検証

## テスト基準
- 全機能に対応する統合テストが必要
- テストはハッピーパス、エッジケース、エラー条件をカバーする必要がある
- テストファイルは命名規則に従う: `test_[機能名].html`
- 自動テストランナーがデプロイ前に全機能を検証