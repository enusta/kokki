# Requirements Document

## Introduction

国旗あてゲームは、日本の子ども（幼児～小学生）を主な対象とした、世界各国の国旗を見て国名を当てるインタラクティブな教育ゲームです。このゲームには世界地図機能も含まれ、正解した国の地理的位置を視覚的に確認できます。年齢に応じた日本語表示（ひらがな・カタカナ・漢字）により、子どもの読み書きレベルに合わせた学習体験を提供します。

## Requirements

### Requirement 1

**User Story:** ゲームプレイヤーとして、ランダムに表示される国旗を見て正しい国名を選択したい。そうすることで、世界各国の国旗を楽しく覚えることができる。

#### Acceptance Criteria

1. WHEN ゲームが開始される THEN システム SHALL ランダムな国旗を表示する
2. WHEN 国旗が表示される THEN システム SHALL 4つの選択肢（正解1つ、不正解3つ）を提供する
3. WHEN ユーザーが選択肢をクリックする THEN システム SHALL 正解か不正解かを即座に表示する
4. WHEN 正解が選ばれる THEN システム SHALL 正解音またはビジュアルフィードバックを提供する
5. WHEN 不正解が選ばれる THEN システム SHALL 正しい答えを表示する

### Requirement 2

**User Story:** ゲームプレイヤーとして、正解した国の地理的位置を世界地図で確認したい。そうすることで、国旗と地理的知識を同時に学習できる。

#### Acceptance Criteria

1. WHEN ユーザーが正解する THEN システム SHALL 世界地図上でその国をハイライト表示する
2. WHEN 国がハイライトされる THEN システム SHALL 国名と基本情報（首都、大陸など）を表示する
3. WHEN 地図が表示される THEN システム SHALL インタラクティブなズーム機能を提供する
4. WHEN ユーザーが地図上の他の国をクリックする THEN システム SHALL その国の基本情報を表示する

### Requirement 3

**User Story:** ゲームプレイヤーとして、自分の進捗とスコアを追跡したい。そうすることで、学習の成果を確認し、モチベーションを維持できる。

#### Acceptance Criteria

1. WHEN ゲームセッションが開始される THEN システム SHALL スコアカウンターを0で初期化する
2. WHEN ユーザーが正解する THEN システム SHALL スコアを1ポイント増加させる
3. WHEN ゲームが進行する THEN システム SHALL 現在の問題番号と総正解数を表示する
4. WHEN ゲームセッションが終了する THEN システム SHALL 最終スコアと正解率を表示する
5. WHEN スコア画面が表示される THEN システム SHALL 新しいゲームを開始するオプションを提供する

### Requirement 4

**User Story:** ゲームプレイヤーとして、異なる難易度レベルでプレイしたい。そうすることで、自分のレベルに合わせて学習できる。

#### Acceptance Criteria

1. WHEN ゲーム開始画面が表示される THEN システム SHALL 難易度選択オプション（初級、中級、上級）を提供する
2. WHEN 初級が選択される THEN システム SHALL 有名な国（20-30カ国）の国旗のみを出題する
3. WHEN 中級が選択される THEN システム SHALL より多くの国（50-80カ国）の国旗を出題する
4. WHEN 上級が選択される THEN システム SHALL 全世界の国（150カ国以上）の国旗を出題する
5. IF 難易度が選択される THEN システム SHALL その難易度に応じた問題数を設定する

### Requirement 5

**User Story:** ゲームプレイヤーとして、レスポンシブなデザインでモバイルデバイスでもプレイしたい。そうすることで、いつでもどこでも学習できる。

#### Acceptance Criteria

1. WHEN アプリがモバイルデバイスで表示される THEN システム SHALL タッチフレンドリーなインターフェースを提供する
2. WHEN 画面サイズが変更される THEN システム SHALL レイアウトを適切に調整する
3. WHEN モバイルで地図が表示される THEN システム SHALL タッチジェスチャー（ピンチズーム、パン）をサポートする
4. WHEN 縦向きと横向きが切り替わる THEN システム SHALL レイアウトを自動調整する

### Requirement 6

**User Story:** ゲームプレイヤーとして、同じゲームセッション内で重複した問題が出題されないようにしたい。そうすることで、より多様な国旗を学習でき、ゲーム体験が向上する。

#### Acceptance Criteria

1. WHEN ゲームセッションが開始される THEN システム SHALL 出題済み国旗のリストを初期化する
2. WHEN 新しい問題が生成される THEN システム SHALL 既に出題された国旗を除外する
3. WHEN 国旗が出題される THEN システム SHALL その国旗を出題済みリストに追加する
4. WHEN 選択肢が生成される THEN システム SHALL 可能な限り出題済みの国を選択肢から除外する
5. IF 全ての国旗が出題済みになる THEN システム SHALL 出題済みリストをリセットして継続する

### Requirement 7

**User Story:** 開発者として、フォールバックデータが外部JSONファイルとして管理され、開発時に一度だけ生成できるようにしたい。そうすることで、コードが整理され、データのメンテナンスが容易になる。

#### Acceptance Criteria

1. WHEN フォールバックデータが必要になる THEN システム SHALL 静的JSONファイル（countries.json）からデータを読み込む
2. WHEN 開発者がデータ生成スクリプトを実行する THEN システム SHALL APIからデータを取得してJSONファイルを生成する
3. WHEN countries.jsonファイルが存在する THEN システム SHALL そのファイルをリポジトリにコミットして配布に含める
4. WHEN 本番環境で動作する THEN システム SHALL countries.jsonファイルが常に利用可能である
5. IF 開発者が新しいデータが必要と判断する THEN 手動でスクリプトを再実行してファイルを更新できる

### Requirement 8

**User Story:** 日本の子ども（幼児～小学生）として、年齢に適した日本語で国名を学習したい。そうすることで、読み書きレベルに合わせて効果的に国旗と国名を覚えることができる。

#### Acceptance Criteria

1. WHEN ゲーム開始画面が表示される THEN システム SHALL 表示言語モード（ひらがな、日本語、英語）の選択オプションを提供する
2. WHEN ひらがなモードが選択される THEN システム SHALL 全ての国名をひらがなのみで表示する
3. WHEN 日本語モードが選択される THEN システム SHALL 国名を日本語（カタカナ・漢字含む）で表示する
4. WHEN 英語モードが選択される THEN システム SHALL 国名を英語で表示する（既存機能）
5. WHEN 国データが読み込まれる THEN システム SHALL 各国の日本語名、ひらがな名、首都名、地域名を各言語モードで含むデータを使用する
6. WHEN 正解・不正解のフィードバックが表示される THEN システム SHALL 選択された言語モードで国名を表示する
7. WHEN 地図上で国情報ポップアップが表示される THEN システム SHALL 選択された言語モードで国名を表示する
8. WHEN 地図上で国がハイライトされる THEN システム SHALL 選択された言語モードで国名を表示する
9. WHEN 地図上の他の国がクリックされる THEN システム SHALL 選択された言語モードでその国の情報を表示する
10. WHEN 地図上で国情報が表示される THEN システム SHALL 首都名を選択された言語モードで表示する
11. WHEN 地図上で国情報が表示される THEN システム SHALL 地域名（大陸・地方）を選択された言語モードで表示する
12. WHEN 国データが生成される THEN システム SHALL 各国の首都名と地域名を日本語・ひらがなで含む

### Requirement 9

**User Story:** 開発者として、テストファイルが整理されたフォルダー構造にあることで、特定のテストを素早く見つけて実行できるようにしたい

#### Acceptance Criteria

1. WHEN プロジェクトルートを確認する THEN テストファイルは専用の`tests/`フォルダーに配置されている SHALL
2. WHEN テストフォルダーを確認する THEN テストファイルは機能別にサブフォルダーに分類されている SHALL
3. WHEN 既存のテストファイルを移動する THEN 全てのテストファイルが新しい場所で正常に動作する SHALL
4. WHEN テストランナーを実行する THEN 新しいフォルダー構造のテストファイルを正しく検出する SHALL
5. WHEN テストファイルを確認する THEN 全てのテストファイルが一貫した命名規則に従っている SHALL