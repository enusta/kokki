# Implementation Plan

- [x] 1. プロジェクト基盤とHTML構造の作成





  - 基本的なHTMLファイル（index.html）を作成し、必要なCDNリンクを設定
  - CSSファイルでレスポンシブな基本レイアウトを実装
  - JavaScriptファイルの基本構造を作成
  - _Requirements: 5.1, 5.2, 5.4_

- [x] 2. 国データ取得機能の実装





  - REST Countries APIからデータを取得するcountryService.jsを実装
  - エラーハンドリングとローカルストレージキャッシュ機能を追加
  - 難易度別の国フィルタリング機能を実装
  - _Requirements: 4.2, 4.3, 4.4_

- [x] 3. 基本的なクイズ機能の実装





  - ランダムな国旗表示機能をgame.jsに実装
  - 4択選択肢生成ロジックを作成
  - 正解・不正解判定機能を実装
  - _Requirements: 1.1, 1.2, 1.3_

- [x] 4. UI操作とフィードバック機能





  - 国旗画像とオプションボタンの表示機能をui.jsに実装
  - 正解時のビジュアルフィードバック（色変更、アニメーション）を追加
  - 不正解時の正解表示機能を実装
  - _Requirements: 1.4, 1.5_

- [x] 5. スコア管理機能の実装





  - スコアカウンターとプログレス表示機能を実装
  - 問題番号と正解数の表示を追加
  - 最終スコアと正解率の計算・表示機能を実装
  - _Requirements: 3.1, 3.2, 3.3, 3.4_

- [x] 6. 世界地図統合機能





  - Leaflet.jsを使用した地図初期化機能をmap.jsに実装
  - 正解時の国ハイライト表示機能を追加
  - 国の基本情報（首都、大陸）表示機能を実装
  - _Requirements: 2.1, 2.2_

- [x] 7. 難易度選択とゲーム制御





  - ゲーム開始画面と難易度選択UIを実装
  - 難易度に応じた問題数設定機能を追加
  - 新しいゲーム開始とリセット機能を実装
  - _Requirements: 4.1, 4.5, 3.5_

- [x] 8. インタラクティブ地図機能





  - 地図のズーム・パン機能を実装
  - 地図上の他の国クリック時の情報表示を追加
  - モバイル向けタッチジェスチャー対応を実装
  - _Requirements: 2.3, 2.4, 5.3_

- [x] 9. エラーハンドリングとパフォーマンス最適化





  - ネットワークエラー時のフォールバック機能を実装
  - 画像読み込み失敗時の代替表示を追加
  - 国旗画像のプリロード機能を実装
  - _Requirements: 全般的な安定性向上_

- [x] 10. 最終テストと統合








  - 全機能の統合テストを実行
  - クロスブラウザ互換性の確認とバグ修正
  - モバイルデバイスでの動作確認と調整
  - _Requirements: 5.1, 5.2, 5.3, 5.4_

- [x] 11. 重複防止システムの実装



  - ゲーム状態に出題済み国リスト（usedCountries）を追加
  - 未使用国を選択するgetRandomUnusedCountry関数を実装
  - 選択肢生成時に出題済み国を除外するロジックを追加
  - 全国出題済み時のリセット機能を実装
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 12. 外部フォールバックデータシステムの実装


- [x] 12.1 データ生成スクリプトの作成



  - REST Countries APIからデータを取得するNode.jsスクリプトを作成
  - 難易度別に国を分類・選択するロジックを実装
  - 最適化されたJSONファイル（countries.json）を生成する機能を追加
  - _Requirements: 7.2, 7.5_



- [x] 12.2 外部JSONファイル読み込み機能の実装

  - countryService.jsに外部JSONファイル読み込み機能を追加
  - データ階層（API → キャッシュ → 静的JSON → 埋め込み）を実装
  - 埋め込みデータを最小限に縮小
  - _Requirements: 7.1, 7.3, 7.4_

- [ ] 13. 日本語対応システムの実装
- [x] 13.1 日本語翻訳データの作成と統合




  - 国名・首都名・地域名の日本語翻訳データを作成
  - データ生成スクリプトに日本語翻訳機能を追加
  - countries.jsonに多言語データ構造を統合
  - _Requirements: 8.5, 8.12_

- [x] 13.2 言語モード選択UIの実装



  - 開始画面に言語モード選択オプションを追加
  - ひらがな・日本語・英語の3つのモード選択UI
  - 選択された言語モードをゲーム状態に保存
  - _Requirements: 8.1_

- [x] 13.3 ゲーム内表示の多言語対応



  - 選択肢表示を言語モードに応じて切り替え
  - 正解・不正解フィードバックの言語対応
  - 表示名取得関数（getCountryName等）の実装
  - _Requirements: 8.2, 8.3, 8.4, 8.6_

- [x] 13.4 地図表示の多言語対応



  - 地図ポップアップの国名・首都名・地域名を言語対応
  - 国ハイライト時の表示を言語対応
  - 地図クリック時の情報表示を言語対応
  - _Requirements: 8.7, 8.8, 8.9, 8.10, 8.11_

- [x] 14. テストファイル構造の整理と最適化
  - testsフォルダーを作成し、機能別サブフォルダー（core、ui、services、map）に分類
  - 既存のテストファイルを新しいフォルダー構造に移動
  - テストファイル内の相対パス参照を新しい構造に合わせて更新
  - テストランナー（run_integration_tests.js）を新しい構造に対応するよう更新
  - テスト実行ガイドとなるREADMEファイルをtestsフォルダーに作成
  - _Requirements: 9.1, 9.2, 9.3, 9.4, 9.5_